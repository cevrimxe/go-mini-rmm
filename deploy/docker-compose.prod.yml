version: "3.8"

services:
  server:
    image: ghcr.io/cevrimxe/go-mini-rmm-server:latest
    container_name: rmm-server
    ports:
      - "9090:9090"
    volumes:
      - rmm-data:/app/data
    command: ["-addr", ":9090", "-db", "/app/data/rmm.db"]
    restart: unless-stopped
    labels:
      - "com.centurylinklabs.watchtower.enable=true"

  agent:
    image: ghcr.io/cevrimxe/go-mini-rmm-agent:latest
    container_name: rmm-agent-local
    command: ["-server", "http://server:9090", "-key", "sunucu-agent"]
    depends_on:
      - server
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    restart: unless-stopped
    labels:
      - "com.centurylinklabs.watchtower.enable=true"

  watchtower:
    image: containrrr/watchtower
    container_name: watchtower
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    command: --interval 60 --cleanup --label-enable
    restart: unless-stopped

volumes:
  rmm-data:
